<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8">

		<style type="text/css">
			#screen {
				width: 100%;
			}

			.container {
				width: 40%;
				margin: auto;
			}

			.text-center {
				text-align: center;
			}
		</style>

		<script defer type="text/javascript">
			function uploadRom(files) {
				let reader = new FileReader();
				reader.onload = function(event) {
					let rom_src = event.target.result;
					let array = new Uint8Array(rom_src);
					let buffer = Module._malloc(rom_src.byteLength);
					Module.writeArrayToMemory(array, buffer);
					Gameboy.rom_ptr = buffer;
					Gameboy.rom_size = rom_src.byteLength;
				}
				reader.readAsArrayBuffer(files[0]);
			}

			function uploadRam(files) {
				let reader = new FileReader();
				reader.onload = function(event) {
					let ram_src = event.target.result;
					let array = new Uint8Array(ram_src);
					let buffer = Module._malloc(rom_src.byteLength);
					Module.writeArrayToMemory(array, buffer);
					Gameboy.ram_ptr = buffer;
					Gameboy.ram_size = ram_src.byteLength;
				}
				reader.readAsArrayBuffer(files[0]);
			}

			var Module = {
				wasmBinary: null,
				print: function(text) {
					console.log(text);
				},
				printErr: function(text) {
					console.error(text);
				},
			};

			var xhr = new XMLHttpRequest();
			xhr.open('GET', 'rustboy.wasm', true);
			xhr.responseType = 'arraybuffer';
			xhr.onload = function() {
				Module.wasmBinary = xhr.response;
				var script = document.createElement('script');
				script.src = "rustboy-loader.js";
				document.head.appendChild(script);
			};
			xhr.send(null);
		</script>
	</head>

	<body>
		<div class="container">
			<h3 class="text-center">Rustboy web assembly test</h3>
			<canvas id="screen" width="160" height="144" style="border: 1px solid black"></canvas>
			<br/>
			<input type="file" id="file-input" onchange="uploadRom(this.files)"></input>
			<button type=button id="reset">Reset</button>
		</div>
	</body>
</html>
